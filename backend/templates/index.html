<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Publishing Platform</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Quill Text Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #7c3aed;
            --success-color: #059669;
            --danger-color: #dc2626;
            --warning-color: #f59e0b;
            --bg-light: #f9fafb;
            --card-bg: #ffffff;
            --dark-color: #1f2937;
            --border-radius: 0.5rem;
            --box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-light);
            color: var(--dark-color);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2.5rem 0;
            margin-bottom: 2rem;
            border-bottom-left-radius: 2rem;
            border-bottom-right-radius: 2rem;
            box-shadow: var(--box-shadow);
        }

        .section-title {
            font-weight: 600;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 3px;
        }

        .card {
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .card-header {
            background-color: var(--card-bg);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-weight: 600;
        }

        .post-item {
            transition: all 0.3s;
            position: relative;
            border-left: 3px solid transparent;
            padding-left: 1rem;
        }

        .post-item:hover {
            transform: translateX(5px);
            background-color: rgba(37, 99, 235, 0.05);
            border-left-color: var(--primary-color);
        }

        .post-item.active {
            background-color: rgba(37, 99, 235, 0.1);
            border-left-color: var(--primary-color);
        }

        .status-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-draft { 
            background-color: #e5e7eb; 
            color: #4b5563;
        }
        
        .status-flagged { 
            background-color: #fee2e2; 
            color: var(--danger-color);
        }
        
        .status-approved { 
            background-color: #d1fae5; 
            color: var(--success-color);
        }
        
        .status-published { 
            background-color: #dbeafe; 
            color: var(--primary-color);
        }

        .btn {
            border-radius: 0.5rem;
            font-weight: 500;
            padding: 0.5rem 1.25rem;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
            border-color: #1d4ed8;
        }

        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #047857;
            border-color: #047857;
        }

        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #b91c1c;
            border-color: #b91c1c;
        }

        .btn-outline-primary {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .form-control, .form-select {
            border-radius: 0.5rem;
            padding: 0.625rem 1rem;
            border: 1px solid #e5e7eb;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(37, 99, 235, 0.25);
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            border: 1px solid #e5e7eb;
            background-color: white;
            color: #4b5563;
            transition: all 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .flagged-reasons {
            background-color: #fee2e2;
            border-left: 4px solid var(--danger-color);
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            border-radius: 0.5rem;
        }

        .action-buttons {
            margin-top: 1.5rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .stats-card {
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .stats-card h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stats-card p {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0;
        }

        .stats-card.primary {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
        }

        .stats-card.success {
            background-color: rgba(5, 150, 105, 0.1);
            color: var(--success-color);
        }

        .stats-card.warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .stats-card.danger {
            background-color: rgba(220, 38, 38, 0.1);
            color: var(--danger-color);
        }

        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 999px;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            background-color: #e5e7eb;
            color: #4b5563;
        }

        .ql-toolbar {
            border-top-left-radius: var(--border-radius);
            border-top-right-radius: var(--border-radius);
            border-color: #e5e7eb;
        }

        .ql-container {
            min-height: 200px;
            max-height: 400px;
            border-bottom-left-radius: var(--border-radius);
            border-bottom-right-radius: var(--border-radius);
            border-color: #e5e7eb;
        }

        .public-post-card {
            border: none;
            border-radius: 0.75rem;
            overflow: hidden;
            transition: transform 0.3s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }

        .public-post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .public-post-card .card-img-top {
            height: 180px;
            object-fit: cover;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .custom-toast {
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c5c7ca;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8abb0;
        }

        .post-metadata {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .post-metadata .icon {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .reading-time {
            font-size: 0.875rem;
            color: #6b7280;
        }

        footer {
            background-color: #1f2937;
            color: #e5e7eb;
            padding: 3rem 0 1.5rem;
            margin-top: 5rem;
        }

        .footer-links h5 {
            color: white;
            margin-bottom: 1.25rem;
            font-weight: 600;
        }

        .footer-links ul {
            list-style: none;
            padding-left: 0;
        }

        .footer-links li {
            margin-bottom: 0.75rem;
        }

        .footer-links a {
            color: #d1d5db;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: white;
        }

        .social-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            margin-right: 0.75rem;
            transition: background-color 0.3s;
        }

        .social-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .copyright {
            color: #9ca3af;
            font-size: 0.875rem;
            text-align: center;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Public view toggle switch */
        .form-switch .form-check-input {
            width: 3em;
            height: 1.5em;
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .tab-content {
            padding: 1.5rem;
        }

        .nav-tabs .nav-link {
            border: none;
            font-weight: 500;
            color: #6b7280;
            padding: 0.75rem 1rem;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: transparent;
            border-bottom: 2px solid var(--primary-color);
        }

        .character-count {
            font-size: 0.75rem;
            color: #6b7280;
            text-align: right;
            margin-top: 0.25rem;
        }

        /* Loading spinner */
        .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(3px);
        }

        .spinner-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .pulse-spinner {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.5; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.5; }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .header {
                padding: 1.5rem 0;
                border-radius: 0;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container for Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Loading Spinner -->
    <div class="spinner-overlay d-none" id="loading-spinner">
        <div class="spinner-container">
            <div class="pulse-spinner"></div>
            <p class="mt-3 fw-bold">Processing...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8 text-center text-md-start" data-aos="fade-right">
                    <h1 class="display-4 fw-bold mb-2">Content Publishing Platform</h1>
                    <p class="lead opacity-90 mb-4">Create, moderate, and publish your content with AI-powered assistance</p>
                    <button class="btn btn-light btn-lg px-4 me-2" id="new-post-btn">
                        <i class="fas fa-pen-fancy me-2"></i>Create New Post
                    </button>
                    <button class="btn btn-outline-light btn-lg px-4" id="view-public-btn">
                        <i class="fas fa-globe me-2"></i>View Public
                    </button>
                </div>
                <div class="col-md-4 d-none d-md-block" data-aos="fade-left">
                    <img src="https://cdn-icons-png.flaticon.com/512/3987/3987958.png" alt="Publishing Platform" class="img-fluid" style="max-height: 200px;">
                </div>
            </div>
        </div>
    </header>

    <!-- Stats Section -->
    <div class="container mb-4">
        <div class="row" id="stats-row">
            <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="100">
                <div class="stats-card primary">
                    <i class="fas fa-file-alt fa-2x mb-2"></i>
                    <h2 id="total-posts-count">0</h2>
                    <p>Total Posts</p>
                </div>
            </div>
            <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="200">
                <div class="stats-card success">
                    <i class="fas fa-check-circle fa-2x mb-2"></i>
                    <h2 id="published-count">0</h2>
                    <p>Published</p>
                </div>
            </div>
            <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="300">
                <div class="stats-card warning">
                    <i class="fas fa-pencil-alt fa-2x mb-2"></i>
                    <h2 id="draft-count">0</h2>
                    <p>Drafts</p>
                </div>
            </div>
            <div class="col-md-3 col-6" data-aos="fade-up" data-aos-delay="400">
                <div class="stats-card danger">
                    <i class="fas fa-flag fa-2x mb-2"></i>
                    <h2 id="flagged-count">0</h2>
                    <p>Flagged</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <!-- Left Column - Post Management -->
            <div class="col-lg-4">
                <div class="card mb-4" data-aos="fade-right">
                    <div class="card-header d-flex justify-content-between align-items-center py-3">
                        <h5 class="mb-0">Manage Posts</h5>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-primary dropdown-toggle" type="button" id="postOptionsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="postOptionsDropdown">
                                <li><a class="dropdown-item" href="#" id="refresh-posts-btn"><i class="fas fa-sync-alt me-2"></i>Refresh Posts</a></li>
                                <li><a class="dropdown-item" href="#" id="sort-date-btn"><i class="fas fa-clock me-2"></i>Sort by Date</a></li>
                                <li><a class="dropdown-item" href="#" id="sort-title-btn"><i class="fas fa-font me-2"></i>Sort by Title</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="p-3">
                            <div class="input-group">
                                <span class="input-group-text bg-white border-end-0">
                                    <i class="fas fa-search text-muted"></i>
                                </span>
                                <input type="text" class="form-control border-start-0" id="search-posts" placeholder="Search posts...">
                            </div>
                        </div>
                        <div class="p-3 border-top border-bottom">
                            <div class="d-flex flex-wrap">
                                <button class="filter-btn active" data-filter="all">All</button>
                                <button class="filter-btn" data-filter="draft">Drafts</button>
                                <button class="filter-btn" data-filter="flagged">Flagged</button>
                                <button class="filter-btn" data-filter="approved">Approved</button>
                                <button class="filter-btn" data-filter="published">Published</button>
                            </div>
                        </div>
                        <div class="list-group list-group-flush" id="post-list">
                            <!-- Posts will be loaded here dynamically -->
                            <div class="text-center p-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2 text-muted">Loading posts...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recently Published Section -->
                <div class="card d-none" id="recent-published-card" data-aos="fade-up">
                    <div class="card-header">
                        <h5 class="mb-0">Recently Published</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush" id="recent-published-list">
                            <!-- Recently published posts will appear here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Post Editor/Viewer -->
            <div class="col-lg-8">
                <!-- Post Editor Card -->
                <div class="card" id="post-editor-card" data-aos="fade-left">
                    <div class="card-header d-flex justify-content-between align-items-center py-3">
                        <h5 id="editor-title" class="mb-0">Create New Post</h5>
                        <div class="form-check form-switch d-none" id="autosave-container">
                            <input class="form-check-input" type="checkbox" id="autosave-toggle" checked>
                            <label class="form-check-label" for="autosave-toggle">Autosave</label>
                        </div>
                    </div>
                    <div class="card-body">
                        <form id="post-form">
                            <input type="hidden" id="post-id">
                            
                            <div class="mb-3">
                                <label for="post-title" class="form-label">Title</label>
                                <input type="text" class="form-control" id="post-title" required>
                                <div class="character-count" id="title-character-count">0/100 characters</div>
                            </div>
                            
                            <!-- Tags input (new feature) -->
                            <div class="mb-3">
                                <label for="post-tags" class="form-label">Tags (comma separated)</label>
                                <input type="text" class="form-control" id="post-tags" placeholder="technology, news, tutorial">
                                <div class="mt-2" id="tags-preview"></div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="editor-container" class="form-label">Content</label>
                                <div id="editor-container"></div> <!-- Quill editor will be mounted here -->
                                <div class="character-count" id="content-character-count">0 words</div>
                            </div>
                            
                            <div id="status-container" class="mb-3 d-none">
                                <label class="form-label">Status</label>
                                <div>
                                    <span id="status-badge" class="badge status-badge"></span>
                                </div>
                            </div>
                            
                            <div id="flagged-reasons-container" class="flagged-reasons mb-3 d-none">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                    <strong>Content Flagged</strong>
                                </div>
                                <p id="flagged-reasons-text"></p>
                                <div class="bg-white p-2 rounded mt-2 border">
                                    <p class="mb-1 fw-medium">Suggestions to fix:</p>
                                    <ul class="mb-0" id="fix-suggestions-list">
                                        <!-- Suggestions will be added dynamically -->
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- AI Assistance Section (New Feature) -->
                            <div class="card mb-3 border-primary" id="ai-assistant-card">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-robot me-2"></i>AI Writing Assistant
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex gap-2 mb-3">
                                        <button type="button" class="btn btn-sm btn-outline-primary ai-btn" data-action="improve">Improve Writing</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary ai-btn" data-action="shorten">Make Concise</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary ai-btn" data-action="expand">Expand Content</button>
                                        <button type="button" class="btn btn-sm btn-outline-primary ai-btn" data-action="check">Check Issues</button>
                                    </div>
                                    <div class="ai-response d-none" id="ai-response-container">
                                        <div class="border rounded p-3 bg-light">
                                            <div class="d-flex justify-content-between mb-2">
                                                <span class="fw-bold"><i class="fas fa-lightbulb text-warning me-2"></i>AI Suggestion</span>
                                                <button type="button" class="btn btn-sm btn-outline-success" id="apply-suggestion-btn">Apply</button>
                                            </div>
                                            <p id="ai-suggestion-text" class="mb-0">The AI suggestion will appear here.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button type="submit" class="btn btn-primary" id="save-button">
                                    <i class="fas fa-save me-1"></i>Save Draft
                                </button>
                                <button type="button" class="btn btn-success d-none" id="review-button">
                                    <i class="fas fa-check-circle me-1"></i>Submit for Review
                                </button>
                                <button type="button" class="btn btn-info text-white d-none" id="publish-button">
                                    <i class="fas fa-upload me-1"></i>Publish
                                </button>
                                <button type="button" class="btn btn-outline-danger" id="cancel-button">
                                    <i class="fas fa-times me-1"></i>Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Post Viewer Card -->
                <div class="card d-none" id="post-viewer-card" data-aos="fade-left">
                    <div class="card-header d-flex justify-content-between align-items-center py-3">
                        <h5 id="viewer-title" class="mb-0"></h5>
                        <div>
                            <span id="viewer-status-badge" class="badge status-badge"></span>
                            <button class="btn btn-sm btn-primary ms-2 d-none" id="edit-button">
                                <i class="fas fa-edit me-1"></i>Edit
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="post-metadata mb-4">
                            <span class="created-date"><i class="far fa-calendar-alt icon me-1"></i><span id="viewer-date"></span></span>
                            <span class="reading-time"><i class="far fa-clock icon me-1"></i><span id="viewer-reading-time"></span></span>
                        </div>
                        
                        <!-- Tags display -->
                        <div id="viewer-tags-container" class="mb-3 d-none">
                            <div id="viewer-tags"></div>
                        </div>
                        
                        <div id="viewer-content" class="mb-4"></div>
                        
                        <div id="viewer-flagged-reasons" class="flagged-reasons mt-4 d-none">
                            <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                                <strong>Content Flagged</strong>
                            </div>
                            <p id="viewer-flagged-reasons-text"></p>
                        </div>
                        
                        <div class="action-buttons">
                            <button type="button" class="btn btn-success d-none" id="viewer-review-button">
                                <i class="fas fa-check-circle me-1"></i>Submit for Review
                            </button>
                            <button type="button" class="btn btn-info text-white d-none" id="viewer-publish-button">
                                <i class="fas fa-upload me-1"></i>Publish
                            </button>
                            <button type="button" class="btn btn-primary d-none" id="viewer-back-button">
                                <i class="fas fa-arrow-left me-1"></i>Back to List
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Public View Card -->
                <div class="card d-none" id="public-view-card" data-aos="fade-up">
                    <div class="card-header d-flex justify-content-between align-items-center py-3">
                        <h5 class="mb-0">Published Posts</h5>
                        <button class="btn btn-sm btn-primary" id="back-to-manager-btn">
                            <i class="fas fa-cog me-1"></i>Back to Manager
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row" id="public-posts-container">
                            <!-- Public posts will be loaded here -->
                            <div class="col-12 text-center p-5">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-3 text-muted">Loading published posts...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0">
                    <h5>Content Publishing Platform</h5>
                    <p class="text-muted mb-4">Create, moderate, and publish your content with AI-powered assistance. Reach your audience with high-quality, approved content.</p>
                    <div class="social-icons">
                        <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="col-md-2 col-6 mb-4 mb-md-0 footer-links">
                    <h5>Platform</h5>
                    <ul>
                        <li><a href="#">Features</a></li>
                        <li><a href="#">Security</a></li>
                        <li><a href="#">Pricing</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-6 mb-4 mb-md-0 footer-links">
                    <h5>Company</h5>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Blog</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-4 footer-links">
                    <h5>Newsletter</h5>
                    <p class="text-muted">Subscribe to our newsletter for the latest updates.</p>
                    <div class="input-group mb-3">
                        <input type="email" class="form-control" placeholder="Email address" aria-label="Email address">
                        <button class="btn btn-primary" type="button">Subscribe</button>
                    </div>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 Content Publishing Platform. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Quill Text Editor -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    
    <!-- AOS Animation Library -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- Main JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize AOS animations
            AOS.init({
                duration: 800,
                once: true
            });
            
            // DOM Elements
            const postList = document.getElementById('post-list');
            const postForm = document.getElementById('post-form');
            const postEditorCard = document.getElementById('post-editor-card');
            const postViewerCard = document.getElementById('post-viewer-card');
            const publicViewCard = document.getElementById('public-view-card');
            const recentPublishedCard = document.getElementById('recent-published-card');
            const recentPublishedList = document.getElementById('recent-published-list');
            
            const postIdInput = document.getElementById('post-id');
            const postTitleInput = document.getElementById('post-title');
            const postTagsInput = document.getElementById('post-tags');
            const tagsPreviewContainer = document.getElementById('tags-preview');
            const editorContainer = document.getElementById('editor-container');
            const statusContainer = document.getElementById('status-container');
            const statusBadge = document.getElementById('status-badge');
            const flaggedReasonsContainer = document.getElementById('flagged-reasons-container');
            const flaggedReasonsText = document.getElementById('flagged-reasons-text');
            const fixSuggestionsList = document.getElementById('fix-suggestions-list');
            
            const saveButton = document.getElementById('save-button');
            const reviewButton = document.getElementById('review-button');
            const publishButton = document.getElementById('publish-button');
            const cancelButton = document.getElementById('cancel-button');
            const editButton = document.getElementById('edit-button');
            
            const viewerTitle = document.getElementById('viewer-title');
            const viewerDate = document.getElementById('viewer-date');
            const viewerReadingTime = document.getElementById('viewer-reading-time');
            const viewerStatusBadge = document.getElementById('viewer-status-badge');
            const viewerContent = document.getElementById('viewer-content');
            const viewerTagsContainer = document.getElementById('viewer-tags-container');
            const viewerTags = document.getElementById('viewer-tags');
            const viewerFlaggedReasons = document.getElementById('viewer-flagged-reasons');
            const viewerFlaggedReasonsText = document.getElementById('viewer-flagged-reasons-text');
            const viewerReviewButton = document.getElementById('viewer-review-button');
            const viewerPublishButton = document.getElementById('viewer-publish-button');
            const viewerBackButton = document.getElementById('viewer-back-button');
            
            const newPostBtn = document.getElementById('new-post-btn');
            const viewPublicBtn = document.getElementById('view-public-btn');
            const backToManagerBtn = document.getElementById('back-to-manager-btn');
            const editorTitle = document.getElementById('editor-title');
            const filterButtons = document.querySelectorAll('.filter-btn');
            const searchInput = document.getElementById('search-posts');
            const refreshPostsBtn = document.getElementById('refresh-posts-btn');
            const sortDateBtn = document.getElementById('sort-date-btn');
            const sortTitleBtn = document.getElementById('sort-title-btn');
            const publicPostsContainer = document.getElementById('public-posts-container');
            const loadingSpinner = document.getElementById('loading-spinner');
            const toastContainer = document.getElementById('toast-container');
            
            // Stats elements
            const totalPostsCount = document.getElementById('total-posts-count');
            const publishedCount = document.getElementById('published-count');
            const draftCount = document.getElementById('draft-count');
            const flaggedCount = document.getElementById('flagged-count');
            
            // AI assistance elements
            const aiButtons = document.querySelectorAll('.ai-btn');
            const aiResponseContainer = document.getElementById('ai-response-container');
            const aiSuggestionText = document.getElementById('ai-suggestion-text');
            const applySuggestionBtn = document.getElementById('apply-suggestion-btn');
            
            // Character count elements
            const titleCharacterCount = document.getElementById('title-character-count');
            const contentCharacterCount = document.getElementById('content-character-count');
            
            // Autosave elements
            const autosaveContainer = document.getElementById('autosave-container');
            const autosaveToggle = document.getElementById('autosave-toggle');
            
            let currentFilter = 'all';
            let currentPostId = null;
            let currentSearchTerm = '';
            let sortDirection = 'desc'; // Default to newest first
            let sortField = 'created_at';
            let posts = []; // Store all posts for client-side filtering and sorting
            let autosaveTimer = null;
            let lastSavedContent = '';
            let currentAiSuggestion = '';
            
            // Initialize Quill editor
            const quill = new Quill('#editor-container', {
                theme: 'snow',
                placeholder: 'Write your content here...',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        [{ 'color': [] }, { 'background': [] }],
                        ['blockquote', 'code-block'],
                        ['link', 'image'],
                        ['clean']
                    ]
                }
            });
            
            // Helper function to show loading spinner
            function showLoading() {
                loadingSpinner.classList.remove('d-none');
            }
            
            // Helper function to hide loading spinner
            function hideLoading() {
                loadingSpinner.classList.add('d-none');
            }
            
            // Helper function to show a toast notification
            function showToast(message, type = 'success') {
                const toastId = 'toast-' + Date.now();
                const toast = document.createElement('div');
                toast.className = `toast custom-toast show align-items-center text-white bg-${type} border-0`;
                toast.setAttribute('role', 'alert');
                toast.setAttribute('aria-live', 'assertive');
                toast.setAttribute('aria-atomic', 'true');
                toast.setAttribute('id', toastId);
                
                toast.innerHTML = `
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                `;
                
                toastContainer.appendChild(toast);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.remove();
                }, 5000);
            }
            
            // Helper function to get word count from HTML content
            function getWordCount(html) {
                // Remove HTML tags and count words
                const text = html.replace(/<[^>]*>/g, '');
                const words = text.trim().split(/\s+/);
                return words.filter(word => word.length > 0).length;
            }
            
            // Helper function to calculate reading time
            function calculateReadingTime(html) {
                const wordCount = getWordCount(html);
                const readingTime = Math.ceil(wordCount / 200); // Assuming 200 words per minute
                return readingTime === 1 ? '1 min read' : `${readingTime} mins read`;
            }
            
            // Helper function to update character and word counts
            function updateCounts() {
                // Update title character count
                const titleLength = postTitleInput.value.length;
                titleCharacterCount.textContent = `${titleLength}/100 characters`;
                titleCharacterCount.classList.toggle('text-danger', titleLength > 100);
                
                // Update content word count
                const content = quill.root.innerHTML;
                const wordCount = getWordCount(content);
                contentCharacterCount.textContent = `${wordCount} words`;
            }
            
            // Helper function to render tags preview
            function renderTagsPreview() {
                tagsPreviewContainer.innerHTML = '';
                const tagsValue = postTagsInput.value.trim();
                
                if (tagsValue) {
                    const tags = tagsValue.split(',').map(tag => tag.trim()).filter(tag => tag);
                    tags.forEach(tag => {
                        const tagEl = document.createElement('span');
                        tagEl.className = 'tag';
                        tagEl.textContent = tag;
                        tagsPreviewContainer.appendChild(tagEl);
                    });
                }
            }
            
            // Setup autosave functionality
            function setupAutosave() {
                if (autosaveToggle.checked) {
                    autosaveTimer = setInterval(() => {
                        const currentContent = quill.root.innerHTML;
                        const postTitle = postTitleInput.value.trim();
                        
                        // Only save if there's a title, content has changed, and we're editing an existing post
                        if (postIdInput.value && postTitle && currentContent !== lastSavedContent) {
                            savePostSilently();
                        }
                    }, 30000); // Autosave every 30 seconds
                } else {
                    clearInterval(autosaveTimer);
                }
            }
            
            // Helper function to save post without UI feedback (for autosave)
            function savePostSilently() {
                const postData = {
                    title: postTitleInput.value,
                    content: quill.root.innerHTML,
                    tags: postTagsInput.value
                };
                
                fetch(`/posts/${postIdInput.value}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                })
                .then(response => response.json())
                .then(post => {
                    lastSavedContent = quill.root.innerHTML;
                    console.log('Autosaved successfully');
                })
                .catch(error => {
                    console.error('Error during autosave:', error);
                });
            }
            
            // Load post statistics
            function loadPostStats() {
                fetch('/posts/')
                    .then(response => response.json())
                    .then(data => {
                        // Count posts by status
                        const stats = {
                            total: data.length,
                            published: 0,
                            draft: 0,
                            flagged: 0,
                            approved: 0
                        };
                        
                        data.forEach(post => {
                            stats[post.status]++;
                        });
                        
                        // Update stats display with animation
                        animateCounter(totalPostsCount, 0, stats.total);
                        animateCounter(publishedCount, 0, stats.published);
                        animateCounter(draftCount, 0, stats.draft);
                        animateCounter(flaggedCount, 0, stats.flagged);
                        
                        // Show recently published posts if there are any
                        if (stats.published > 0) {
                            loadRecentlyPublished();
                        }
                    })
                    .catch(error => {
                        console.error('Error loading post statistics:', error);
                    });
            }
            
            // Helper function to animate counting
            function animateCounter(element, start, end) {
                const duration = 1000; // Animation duration in milliseconds
                const frameDuration = 1000 / 60; // 60fps
                const totalFrames = Math.round(duration / frameDuration);
                const increment = (end - start) / totalFrames;
                
                let currentFrame = 0;
                let currentCount = start;
                
                const animate = () => {
                    currentFrame++;
                    currentCount += increment;
                    
                    if (currentFrame === totalFrames) {
                        element.textContent = end;
                    } else {
                        element.textContent = Math.floor(currentCount);
                        requestAnimationFrame(animate);
                    }
                };
                
                animate();
            }
            
            // Load recently published posts
            function loadRecentlyPublished() {
                fetch('/posts/?status=published')
                    .then(response => response.json())
                    .then(posts => {
                        if (posts.length > 0) {
                            recentPublishedCard.classList.remove('d-none');
                            recentPublishedList.innerHTML = '';
                            
                            // Sort by date (newest first) and take the top 3
                            const recentPosts = posts
                                .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                                .slice(0, 3);
                            
                            recentPosts.forEach(post => {
                                const postItem = document.createElement('a');
                                postItem.href = '#';
                                postItem.className = 'list-group-item list-group-item-action';
                                
                                postItem.innerHTML = `
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">${post.title}</h6>
                                        <small>${new Date(post.created_at).toLocaleDateString()}</small>
                                    </div>
                                    <p class="mb-1 text-truncate">${post.content.replace(/<[^>]*>/g, '').substring(0, 60)}...</p>
                                    <small class="text-muted">${calculateReadingTime(post.content)}</small>
                                `;
                                
                                postItem.addEventListener('click', (e) => {
                                    e.preventDefault();
                                    viewPost(post.id);
                                });
                                
                                recentPublishedList.appendChild(postItem);
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error loading recently published posts:', error);
                    });
            }
            
            // Fetch all posts from the server
            function fetchPosts() {
                showLoading();
                
                fetch('/posts/')
                    .then(response => response.json())
                    .then(data => {
                        posts = data; // Store all posts
                        
                        // Apply current filters
                        filterAndDisplayPosts();
                        
                        // Load post statistics
                        loadPostStats();
                        
                        hideLoading();
                    })
                    .catch(error => {
                        console.error('Error fetching posts:', error);
                        postList.innerHTML = '<p class="text-center text-danger p-4">Error loading posts</p>';
                        hideLoading();
                    });
            }
            
            // Filter and display posts based on current criteria
            function filterAndDisplayPosts() {
                postList.innerHTML = '';
                
                // Get filtered posts
                let filteredPosts = [...posts];
                
                // Apply status filter
                if (currentFilter !== 'all') {
                    filteredPosts = filteredPosts.filter(post => post.status === currentFilter);
                }
                
                // Apply search filter if there's a search term
                if (currentSearchTerm) {
                    const searchLower = currentSearchTerm.toLowerCase();
                    filteredPosts = filteredPosts.filter(post => 
                        post.title.toLowerCase().includes(searchLower) || 
                        post.content.toLowerCase().includes(searchLower)
                    );
                }
                
                // Apply sorting
                filteredPosts.sort((a, b) => {
                    const aValue = sortField === 'created_at' 
                        ? new Date(a[sortField]) 
                        : a[sortField].toLowerCase();
                    const bValue = sortField === 'created_at' 
                        ? new Date(b[sortField]) 
                        : b[sortField].toLowerCase();
                    
                    if (sortDirection === 'asc') {
                        return aValue > bValue ? 1 : -1;
                    } else {
                        return aValue < bValue ? 1 : -1;
                    }
                });
                
                // Display no posts message if needed
                if (filteredPosts.length === 0) {
                    postList.innerHTML = `
                        <div class="text-center p-4">
                            <i class="fas fa-search fa-2x text-muted mb-3"></i>
                            <p class="text-muted">No posts found</p>
                        </div>
                    `;
                    return;
                }
                
                // Display filtered posts
                filteredPosts.forEach(post => {
                    const postDate = new Date(post.created_at);
                    const postItem = document.createElement('a');
                    postItem.href = '#';
                    postItem.className = 'list-group-item list-group-item-action post-item';
                    postItem.dataset.postId = post.id;
                    
                    postItem.innerHTML = `
                        <div class="d-flex justify-content-between">
                            <div class="post-info">
                                <h6 class="mb-1">${post.title}</h6>
                                <small class="d-block text-muted">${postDate.toLocaleDateString()}  ${calculateReadingTime(post.content)}</small>
                            </div>
                            <span class="badge status-badge status-${post.status}">${post.status}</span>
                        </div>
                    `;
                    
                    postItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        // Remove active class from all post items
                        document.querySelectorAll('.post-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        
                        // Add active class to clicked item
                        postItem.classList.add('active');
                        
                        viewPost(post.id);
                    });
                    
                    postList.appendChild(postItem);
                });
            }
            
            // View a specific post
            function viewPost(postId) {
                showLoading();
                
                fetch(`/posts/${postId}`)
                    .then(response => response.json())
                    .then(post => {
                        currentPostId = post.id;
                        
                        // Update viewer content
                        viewerTitle.textContent = post.title;
                        viewerDate.textContent = new Date(post.created_at).toLocaleDateString();
                        viewerReadingTime.textContent = calculateReadingTime(post.content);
                        viewerStatusBadge.textContent = post.status;
                        viewerStatusBadge.className = `badge status-badge status-${post.status}`;
                        viewerContent.innerHTML = post.content;
                        
                        // Handle tags if they exist
                        if (post.tags) {
                            viewerTagsContainer.classList.remove('d-none');
                            viewerTags.innerHTML = '';
                            
                            const tags = post.tags.split(',').map(tag => tag.trim()).filter(tag => tag);
                            tags.forEach(tag => {
                                const tagEl = document.createElement('span');
                                tagEl.className = 'tag';
                                tagEl.textContent = tag;
                                viewerTags.appendChild(tagEl);
                            });
                        } else {
                            viewerTagsContainer.classList.add('d-none');
                        }
                        
                        // Show flagged reasons if applicable
                        if (post.status === 'flagged' && post.flagged_reasons) {
                            viewerFlaggedReasons.classList.remove('d-none');
                            viewerFlaggedReasonsText.textContent = post.flagged_reasons;
                        } else {
                            viewerFlaggedReasons.classList.add('d-none');
                        }
                        
                        // Configure buttons based on post status
                        editButton.classList.toggle('d-none', post.status === 'published');
                        viewerReviewButton.classList.toggle('d-none', post.status !== 'draft');
                        viewerPublishButton.classList.toggle('d-none', post.status !== 'approved');
                        viewerBackButton.classList.remove('d-none');
                        
                        // Show viewer, hide editor and public view
                        postEditorCard.classList.add('d-none');
                        publicViewCard.classList.add('d-none');
                        postViewerCard.classList.remove('d-none');
                        
                        hideLoading();
                    })
                    .catch(error => {
                        console.error('Error fetching post:', error);
                        showToast('Failed to load post details', 'danger');
                        hideLoading();
                    });
            }
            
            // Show the post editor for a new post or editing
            function showPostEditor(editMode = false) {
                // Clear interval if it exists
                if (autosaveTimer) {
                    clearInterval(autosaveTimer);
                    autosaveTimer = null;
                }
                
                if (!editMode) {
                    // New post mode
                    editorTitle.textContent = 'Create New Post';
                    postIdInput.value = '';
                    postTitleInput.value = '';
                    postTagsInput.value = '';
                    tagsPreviewContainer.innerHTML = '';
                    quill.root.innerHTML = '';
                    lastSavedContent = '';
                    
                    statusContainer.classList.add('d-none');
                    flaggedReasonsContainer.classList.add('d-none');
                    autosaveContainer.classList.add('d-none');
                    
                    reviewButton.classList.add('d-none');
                    publishButton.classList.add('d-none');
                    saveButton.textContent = 'Save Draft';
                } else {
                    // Show autosave toggle for edit mode
                    autosaveContainer.classList.remove('d-none');
                    setupAutosave();
                }
                
                // Show editor, hide viewer and public view
                postViewerCard.classList.add('d-none');
                publicViewCard.classList.add('d-none');
                postEditorCard.classList.remove('d-none');
                
                // Focus on title input and update character count
                postTitleInput.focus();
                updateCounts();
            }
            
            // Edit an existing post
            function editPost() {
                showLoading();
                
                fetch(`/posts/${currentPostId}`)
                    .then(response => response.json())
                    .then(post => {
                        editorTitle.textContent = 'Edit Post';
                        postIdInput.value = post.id;
                        postTitleInput.value = post.title;
                        
                        // Set tags if they exist
                        if (post.tags) {
                            postTagsInput.value = post.tags;
                            renderTagsPreview();
                        } else {
                            postTagsInput.value = '';
                            tagsPreviewContainer.innerHTML = '';
                        }
                        
                        // Set content
                        quill.root.innerHTML = post.content;
                        lastSavedContent = post.content;
                        
                        // Show status
                        statusBadge.textContent = post.status;
                        statusBadge.className = `badge status-badge status-${post.status}`;
                        statusContainer.classList.remove('d-none');
                        
                        // Show flagged reasons and suggestions if applicable
                        if (post.status === 'flagged' && post.flagged_reasons) {
                            flaggedReasonsContainer.classList.remove('d-none');
                            flaggedReasonsText.textContent = post.flagged_reasons;
                            
                            // Generate suggestions based on flagged reasons
                            generateFixSuggestions(post.flagged_reasons);
                        } else {
                            flaggedReasonsContainer.classList.add('d-none');
                        }
                        
                        // Configure buttons based on post status
                        reviewButton.classList.toggle('d-none', post.status !== 'draft');
                        publishButton.classList.toggle('d-none', post.status !== 'approved');
                        saveButton.textContent = 'Update Post';
                        
                        showPostEditor(true);
                        hideLoading();
                    })
                    .catch(error => {
                        console.error('Error fetching post for edit:', error);
                        showToast('Failed to load post for editing', 'danger');
                        hideLoading();
                    });
            }
            
            // Generate suggestions for fixing flagged content
            function generateFixSuggestions(flaggedReasons) {
                fixSuggestionsList.innerHTML = '';
                
                const reasonLower = flaggedReasons.toLowerCase();
                
                // Add specific suggestions based on the flagged reasons
                if (reasonLower.includes('offensive')) {
                    addSuggestion('Remove or rephrase offensive language and terminology');
                }
                
                if (reasonLower.includes('too short')) {
                    addSuggestion('Add more detailed content to provide more value to readers');
                }
                
                if (reasonLower.includes('tone')) {
                    addSuggestion('Adjust the tone to be more professional and respectful');
                }
                
                if (reasonLower.includes('banned words')) {
                    addSuggestion('Replace inappropriate words with acceptable alternatives');
                }
                
                // Add a general suggestion if no specific ones were added
                if (fixSuggestionsList.children.length === 0) {
                    addSuggestion('Review and edit your content to address the flagged issues');
                }
            }
            
            // Helper function to add a suggestion
            function addSuggestion(text) {
                const li = document.createElement('li');
                li.textContent = text;
                fixSuggestionsList.appendChild(li);
            }
            
            // Save or update a post
            function savePost(event) {
                event.preventDefault();
                showLoading();
                
                const postData = {
                    title: postTitleInput.value,
                    content: quill.root.innerHTML,
                    tags: postTagsInput.value
                };
                
                if (postIdInput.value) {
                    // Update existing post
                    fetch(`/posts/${postIdInput.value}`, {
                        method: 'PATCH',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(postData)
                    })
                    .then(response => response.json())
                    .then(post => {
                        showToast('Post updated successfully!');
                        fetchPosts(); // Refresh the post list
                        viewPost(post.id);
                    })
                    .catch(error => {
                        console.error('Error updating post:', error);
                        showToast('Failed to update post', 'danger');
                        hideLoading();
                    });
                } else {
                    // Create new post
                    fetch('/posts/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(postData)
                    })
                    .then(response => response.json())
                    .then(post => {
                        showToast('Post created successfully!');
                        fetchPosts(); // Refresh the post list
                        viewPost(post.id);
                    })
                    .catch(error => {
                        console.error('Error creating post:', error);
                        showToast('Failed to create post', 'danger');
                        hideLoading();
                    });
                }
            }
            
            // Submit a post for review
            function submitForReview(postId = null) {
                const id = postId || postIdInput.value;
                showLoading();
                
                fetch(`/posts/${id}/submit/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(response => response.json())
                .then(post => {
                    if (post.status === 'approved') {
                        showToast('Post approved and ready to publish!', 'success');
                    } else if (post.status === 'flagged') {
                        showToast('Post has been flagged for review', 'warning');
                    }
                    fetchPosts(); // Refresh the post list
                    viewPost(post.id);
                })
                .catch(error => {
                    console.error('Error submitting post for review:', error);
                    showToast('Failed to submit post for review', 'danger');
                    hideLoading();
                });
            }
            
            // Publish an approved post
            function publishPost(postId = null) {
                const id = postId || postIdInput.value;
                showLoading();
                
                fetch(`/posts/${id}/publish/`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' }
                })
                .then(response => response.json())
                .then(post => {
                    showToast('Post published successfully!', 'success');
                    fetchPosts(); // Refresh the post list
                    viewPost(post.id);
                })
                .catch(error => {
                    console.error('Error publishing post:', error);
                    showToast('Failed to publish post', 'danger');
                    hideLoading();
                });
            }
            
            // Cancel editing
            function cancelEdit() {
                // Clear autosave timer if it exists
                if (autosaveTimer) {
                    clearInterval(autosaveTimer);
                    autosaveTimer = null;
                }
                
                if (currentPostId) {
                    viewPost(currentPostId);
                } else {
                    postEditorCard.classList.add('d-none');
                    postViewerCard.classList.add('d-none');
                }
            }
            
            // Hide post viewer
            function hidePostViewer() {
                postViewerCard.classList.add('d-none');
                
                // Deselect active post in list
                document.querySelectorAll('.post-item').forEach(item => {
                    item.classList.remove('active');
                });
            }
            
            // Show public view with published posts
            function showPublicView() {
                showLoading();
                
                fetch('/posts/?status=published')
                    .then(response => response.json())
                    .then(posts => {
                        publicPostsContainer.innerHTML = '';
                        
                        if (posts.length === 0) {
                            publicPostsContainer.innerHTML = `
                                <div class="col-12 text-center p-5">
                                    <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                                    <h5>No Published Posts Yet</h5>
                                    <p class="text-muted">Create and publish your first post to see it here.</p>
                                </div>
                            `;
                        } else {
                            posts.forEach(post => {
                                const colEl = document.createElement('div');
                                colEl.className = 'col-md-6 col-lg-4 mb-4';
                                
                                // Create a placeholder image URL (would be replaced by actual post image in a real app)
                                const imageUrl = `https://picsum.photos/seed/${post.id}/600/400`;
                                
                                // Extract first 100 characters of content without HTML tags
                                const contentPreview = post.content.replace(/<[^>]*>/g, '').substring(0, 100) + '...';
                                
                                // Generate tags HTML if tags exist
                                let tagsHtml = '';
                                if (post.tags) {
                                    const tags = post.tags.split(',').map(tag => tag.trim()).filter(tag => tag);
                                    tagsHtml = tags.map(tag => `<span class="tag">${tag}</span>`).join('');
                                }
                                
                                colEl.innerHTML = `
                                    <div class="card public-post-card h-100">
                                        <img src="${imageUrl}" class="card-img-top" alt="Post image">
                                        <div class="card-body">
                                            <h5 class="card-title">${post.title}</h5>
                                            <div class="post-metadata">
                                                <span><i class="far fa-calendar-alt icon"></i> ${new Date(post.created_at).toLocaleDateString()}</span>
                                                <span><i class="far fa-clock icon"></i> ${calculateReadingTime(post.content)}</span>
                                            </div>
                                            <p class="card-text">${contentPreview}</p>
                                            <div class="mt-3">
                                                ${tagsHtml}
                                            </div>
                                        </div>
                                        <div class="card-footer bg-white border-top-0">
                                            <button class="btn btn-sm btn-primary w-100 view-public-post" data-post-id="${post.id}">
                                                Read More <i class="fas fa-arrow-right ms-1"></i>
                                            </button>
                                        </div>
                                    </div>
                                `;
                                
                                publicPostsContainer.appendChild(colEl);
                            });
                            
                            // Add event listeners to view buttons
                            document.querySelectorAll('.view-public-post').forEach(button => {
                                button.addEventListener('click', () => {
                                    const postId = button.dataset.postId;
                                    viewPost(postId);
                                });
                            });
                        }
                        
                        // Show public view, hide other cards
                        postEditorCard.classList.add('d-none');
                        postViewerCard.classList.add('d-none');
                        publicViewCard.classList.remove('d-none');
                        
                        hideLoading();
                    })
                    .catch(error => {
                        console.error('Error loading published posts:', error);
                        showToast('Failed to load published posts', 'danger');
                        hideLoading();
                    });
            }
            
            // Simulate AI assistance
            function simulateAiAssistance(actionType) {
                showLoading();
                
                // Get current content
                const content = quill.root.innerHTML.replace(/<[^>]*>/g, '');
                
                setTimeout(() => {
                    let suggestion = '';
                    
                    switch (actionType) {
                        case 'improve':
                            suggestion = "Your writing can be enhanced with more descriptive language and better sentence structure. Consider replacing generic terms with more specific ones, and vary your sentence length to improve readability.";
                            break;
                        case 'shorten':
                            suggestion = "Your content can be made more concise by removing redundant phrases and focusing on the key points. Try to express your ideas more directly and eliminate unnecessary words.";
                            break;
                        case 'expand':
                            suggestion = "Your content could benefit from additional details and examples. Consider adding relevant statistics, quotes, or case studies to support your main points and provide more value to readers.";
                            break;
                        case 'check':
                            suggestion = "I've detected some potential issues: a few sentences could be clearer, there may be some repetitive phrases, and the tone varies throughout the piece. Consider reviewing these aspects to improve overall quality.";
                            break;
                    }
                    
                    // Store current suggestion
                    currentAiSuggestion = suggestion;
                    
                    // Show AI response
                    aiSuggestionText.textContent = suggestion;
                    aiResponseContainer.classList.remove('d-none');
                    
                    hideLoading();
                }, 1000);
            }
            
            // Event Listeners
            newPostBtn.addEventListener('click', () => showPostEditor(false));
            viewPublicBtn.addEventListener('click', showPublicView);
            backToManagerBtn.addEventListener('click', () => {
                publicViewCard.classList.add('d-none');
                hidePostViewer();
            });
            
            postForm.addEventListener('submit', savePost);
            cancelButton.addEventListener('click', cancelEdit);
            editButton.addEventListener('click', editPost);
            reviewButton.addEventListener('click', () => submitForReview());
            publishButton.addEventListener('click', () => publishPost());
            viewerReviewButton.addEventListener('click', () => submitForReview(currentPostId));
            viewerPublishButton.addEventListener('click', () => publishPost(currentPostId));
            viewerBackButton.addEventListener('click', hidePostViewer);
            
            refreshPostsBtn.addEventListener('click', fetchPosts);
            
            sortDateBtn.addEventListener('click', () => {
                sortField = 'created_at';
                sortDirection = sortDirection === 'desc' ? 'asc' : 'desc';
                filterAndDisplayPosts();
            });
            
            sortTitleBtn.addEventListener('click', () => {
                sortField = 'title';
                sortDirection = sortDirection === 'desc' ? 'asc' : 'desc';
                filterAndDisplayPosts();
            });
            
            // Filter buttons
            filterButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    currentFilter = e.target.dataset.filter;
                    filterAndDisplayPosts();
                });
            });
            
            // Search input
            searchInput.addEventListener('input', (e) => {
                currentSearchTerm = e.target.value.trim();
                filterAndDisplayPosts();
            });
            
            // AI assistance buttons
            aiButtons.forEach(button => {
                button.addEventListener('click', () => {
                    simulateAiAssistance(button.dataset.action);
                });
            });
            
            // Apply AI suggestion
            applySuggestionBtn.addEventListener('click', () => {
                // In a real application, this would apply actual changes
                // For now, we'll just show a success message
                showToast('AI suggestion applied to your content', 'success');
                aiResponseContainer.classList.add('d-none');
            });
            
            // Title input event for character counting
            postTitleInput.addEventListener('input', updateCounts);
            
            // Quill editor events
            quill.on('text-change', updateCounts);
            
            // Tags input event
            postTagsInput.addEventListener('input', renderTagsPreview);
            
            // Autosave toggle
            autosaveToggle.addEventListener('change', setupAutosave);
            
            // Fetch all posts on page load
            fetchPosts();
        });
    </script>
</body>
</html>